# 0. PACKET METADATA

Build_Type: Governance Stewardship System Setup (Final Refined)
Build_ID: LOCAL_BUILD_FINAL_V1.2
Timestamp_UTC: 2025-12-30T05:05:00Z
Repo_Path: LifeOS
Spec_Versions:
  - LifeOS v1.1
  - Alignment Layer v1.4
  - Governance Stewardship PRD v1.0
Scope: Final refinements of the governance stewardship system. Removed emoji from validator output for plain ASCII compatibility and added version metadata (`meta` block) to the artefact index.

# 1. BUILD CONTEXT & AUTHORITY

## Authority Chain
LifeOS v1.1 → Alignment Layer v1.4 → Governance Stewardship PRD v1.0 → this Review Packet.

## Phase Goals (Mechanical)
Implement a minimal, reliable governance stewardship system where GitHub is the single source of truth. Ensure deterministic loading of artefacts via a central index file and automated validation.

## Files Touched (Summary)

MODIFIED_FILES:
- docs/governance/ARTEFACT_INDEX.json
- docs/.pending_root_files/validate_governance_index.py
- docs/10_meta/GOVERNANCE_STEWARDSHIP_REVIEW_PACKET_v1.0.txt (Internal recreation)

# 2. IMPLEMENTATION PLAN MAPPING

| Plan_Section | Brief_Mechanical_Description | Key_Files_Implemented |
|--------------|------------------------------|-----------------------|
| 1. Canonical Index | Central JSON mapping IDs to paths (v1.0.0) | docs/governance/ARTEFACT_INDEX.json |
| 2. Scaffold Files | Deterministically versioned stubs | docs/governance/{charter,surface,envelopes,council,templates}/*.md |
| 3. Validator | Strict path/existence checker (ASCII output) | docs/.pending_root_files/validate_governance_index.py |
| 4. CI Workflow | GitHub Actions trigger logic | docs/.pending_root_files/validate-governance-index.yml |
| 5. Apply Script | Workspace-to-repo root synchroniser | docs/.pending_root_files/APPLY_PENDING_ROOT_FILES.ps1 |

# 3. STRUCTURAL WALKTHROUGH (NON-NORMATIVE, DESCRIPTIVE ONLY)

Module_Path: docs/.pending_root_files/validate_governance_index.py
Role: Core validation logic for the governance system.
Key_Public_Interfaces: [validate_index, main]
Notes: Final refinement to use ASCII [PASSED]/[FAILED] output for maximum log compatibility. Added verification of the index `meta.version` field.

Module_Path: docs/governance/ARTEFACT_INDEX.json
Role: Deterministic lookup table for external loaders.
Notes: Now includes a `meta` block with `version` for schema safety.

# 4. TESTS & VERIFICATION

## Tests Overview

Test_File: docs/.pending_root_files/validate_governance_index.py
Test_Cases:
- Happy Path (Valid index with meta) -> [PASSED]
- Missing File Detection -> [FAILED]
- Traversal Detection (..) -> [FAILED]
- Missing Meta/Version Detection -> [FAILED]

Verification Method: Manual execution of validator script verifying ASCII output format and meta block validation.

# 5. FLATTENED CODEBASE (INCREMENTAL SCOPE)

===== FILE START: docs/governance/ARTEFACT_INDEX.json =====
{
  "meta": {
    "version": "1.0.0"
  },
  "artefacts": {
    "charter": "docs/governance/charter/CHARTER_v1.0.md",
    "decision_surface": "docs/governance/surface/DECISION_SURFACE_v1.0.md",
    "envelopes": "docs/governance/envelopes/ENVELOPES_v1.0.md",
    "council_protocol": "docs/governance/council/COUNCIL_PROTOCOL_v1.0.md",
    "templates_alignment_review": "docs/governance/templates/ALIGNMENT_REVIEW_TEMPLATE_v1.0.md"
  }
}
===== FILE END: docs/governance/ARTEFACT_INDEX.json =====

===== FILE START: docs/.pending_root_files/validate_governance_index.py =====
#!/usr/bin/env python3
"""
LifeOS Governance Artefact Index Validator

Validates docs/governance/ARTEFACT_INDEX.json against the following rules:
1. Valid JSON with "artefacts" object
2. All artefact IDs are non-empty strings
3. All paths are non-empty strings
4. All paths are repo-root relative (start with "docs/governance/")
5. All paths use forward slashes only (no backslashes)
6. All paths are not absolute (Unix or Windows)
7. All paths contain no traversal segments ("..")
8. All paths point to existing files

Usage:
    python tools/validate_governance_index.py [--repo-root PATH]

Exit codes:
    0 - Validation passed
    1 - Validation failed
"""

import argparse
import json
import sys
from pathlib import Path


def validate_index(repo_root: Path) -> list[str]:
    """Validate the governance artefact index. Returns list of error messages."""
    errors: list[str] = []
    index_path = repo_root / "docs" / "governance" / "ARTEFACT_INDEX.json"

    # Check index file exists
    if not index_path.is_file():
        errors.append(f"Index file not found: {index_path}")
        return errors

    # Parse JSON
    try:
        with open(index_path, "r", encoding="utf-8") as f:
            data = json.load(f)
    except json.JSONDecodeError as e:
        errors.append(f"Invalid JSON in index file: {e}")
        return errors

    # Check structure
    if not isinstance(data, dict):
        errors.append("Index must be a JSON object")
        return errors

    if "artefacts" not in data:
        errors.append("Index must contain 'artefacts' key")
        return errors

    if "meta" not in data:
        errors.append("Index must contain 'meta' key")
        return errors

    meta = data["meta"]
    if not isinstance(meta, dict) or "version" not in meta:
        errors.append("'meta' must contain 'version'")
        return errors

    artefacts = data["artefacts"]
    if not isinstance(artefacts, dict):
        errors.append("'artefacts' must be an object")
        return errors

    # Validate each artefact entry
    for artefact_id, artefact_path in artefacts.items():
        prefix = f"[{artefact_id}]"

        # Validate ID
        if not isinstance(artefact_id, str) or not artefact_id.strip():
            errors.append(f"{prefix} Artefact ID must be a non-empty string")
            continue

        # Validate path is non-empty string
        if not isinstance(artefact_path, str) or not artefact_path.strip():
            errors.append(f"{prefix} Path must be a non-empty string")
            continue

        # Check for backslashes
        if "\\" in artefact_path:
            errors.append(f"{prefix} Path must use forward slashes only: {artefact_path}")
            continue

        # Check not absolute (Unix)
        if artefact_path.startswith("/"):
            errors.append(f"{prefix} Path must not be absolute (Unix): {artefact_path}")
            continue

        # Check not absolute (Windows - drive letter)
        if len(artefact_path) >= 2 and artefact_path[1] == ":":
            errors.append(f"{prefix} Path must not be absolute (Windows): {artefact_path}")
            continue

        # Check for traversal segments
        if ".." in artefact_path.split("/"):
            errors.append(f"{prefix} Path must not contain traversal segments (..): {artefact_path}")
            continue

        # Check path starts with docs/governance/
        if not artefact_path.startswith("docs/governance/"):
            errors.append(f"{prefix} Path must start with 'docs/governance/': {artefact_path}")
            continue

        # Check file exists
        full_path = repo_root / artefact_path
        if not full_path.is_file():
            errors.append(f"{prefix} File does not exist: {artefact_path}")
            continue

    return errors


def main() -> int:
    parser = argparse.ArgumentParser(
        description="Validate LifeOS governance artefact index"
    )
    parser.add_argument(
        "--repo-root",
        type=Path,
        default=Path.cwd(),
        help="Repository root directory (default: current directory)",
    )
    args = parser.parse_args()

    repo_root = args.repo_root.resolve()
    print(f"Validating governance index at: {repo_root}")

    errors = validate_index(repo_root)

    if errors:
        print("\n[FAILED] Validation FAILED:\n")
        for error in errors:
            print(f"  * {error}")
        print()
        return 1
    else:
        print("\n[PASSED] Validation passed: All artefacts valid and files exist.\n")
        return 0


if __name__ == "__main__":
    sys.exit(main())
===== FILE END: docs/.pending_root_files/validate_governance_index.py =====

# 6. OPEN QUESTIONS & IMPLEMENTER NOTES

## 6.1 OPEN_QUESTIONS_FOR_COUNCIL

NONE at this stage. Standard infrastructure established.

## 6.2 IMPLEMENTER_NOTES (NON-NORMATIVE)

- Output format refined to ASCII-only ([PASSED]/[FAILED]) for maximum compatibility with all terminal and log viewers.
- Index schema version (1.0.0) added to support future migrations without breaking existing loader protocols.
