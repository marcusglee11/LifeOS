#!/bin/bash
#
# Git Pre-Push Hook for LifeOS
# Enforces: No direct pushes to main
#

PROTECTED_BRANCHES=("main" "master")

while read local_ref local_sha remote_ref remote_sha
do
    # remote_ref is usually something like refs/heads/main
    # Extract branch name
    branch_name="${remote_ref#refs/heads/}"
    
    for protected in "${PROTECTED_BRANCHES[@]}"; do
        if [ "$branch_name" = "$protected" ]; then
            echo ""
            echo "ðŸš« BLOCKED: Direct push to '$branch_name' is prohibited."
            echo "   Please use a Pull Request via 'python scripts/git_workflow.py review prepare'"
            echo ""
            echo "   To bypass in EMERGENCY (requires accountability):"
            echo "   git push --no-verify ..."
            echo "   Then run: python scripts/git_workflow.py emergency push --reason '...'"
            echo ""
            exit 1
        fi
    done
done

exit 0
