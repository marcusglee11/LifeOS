# Tool Invoke Hardening Phase 2 — Evidence Report

**Mission**: Tool Invoke Hardening (CI Symlink Enforcement + Error Semantics Lock)
**Version**: 1.0
**Date**: 2026-01-10
**Author**: Antigravity Agent
**Status**: PASS

---

## Executive Summary

Hardened the `tool_invoke` substrate with:

1. CI enforcement of symlink test execution on non-Windows platforms
2. Verified error.type semantics are properly locked
3. Declared decision_reason as non-contract-stable

---

## Platform Matrix

| Platform | Tests Run | Passed | Failed | Skipped | Symlink Status |
|----------|-----------|--------|--------|---------|----------------|
| Windows  | 55        | 55     | 0      | 2       | Skipped (Expected) |
| Linux*   | 57        | 57     | 0      | 0       | **Run & Passed** (Verified via WSL) |

*Linux verification executed via WSL to simulate CI environment.

---

## Files Changed (Sorted, Repo-Relative)

| Path | Change |
|------|--------|
| `.github/workflows/tool_invoke_hardening.yml` | NEW |
| `runtime/tools/pytest_runner.py` | MODIFIED (Portability Fix) |
| `scripts/verify_tool_invoke_coverage.py` | NEW |

---

## Error Semantics Lock (Verified)

Existing tests already assert exact `error.type`:

| Error Type | Coverage |
|------------|----------|
| `GovernanceUnavailable` | `test_tool_policy.py`, `test_tool_invoke_integration.py` |
| `PolicyDenied` | `test_tool_filesystem.py`, `test_tool_invoke_integration.py` |
| `NotFound` | `test_tool_filesystem.py` |
| `EncodingError` | `test_tool_filesystem.py` |
| `Timeout` | `test_pytest_runner.py` |
| `SchemaError` | `test_tool_filesystem.py`, `test_pytest_runner.py` |

---

## decision_reason Contract

**Status**: NOT contract-stable (per approved plan v0.2)

Tests verify:

- `decision_reason` is present and non-empty
- No exact string matching (prevents brittleness)

---

## CI Workflow Summary

**File**: `.github/workflows/tool_invoke_hardening.yml`

| Job | Platform | Symlink Skips |
|-----|----------|---------------|
| `test-linux` | ubuntu-latest | FAIL if skipped |
| `test-windows` | windows-latest | PASS (allowed) |

---

## Windows Verification Output

**Command:** `python scripts/verify_tool_invoke_coverage.py`

```
=== Tool Invoke Coverage Verifier ===
Platform: win32
Windows Mode: True

=== Test Results ===
Passed:  55
Failed:  0
Skipped: 2

Skipped tests:
  - test_symlink_root_raises_governance_unavailable
  - test_symlink_escape_blocked

⚠️  Windows: 2 symlink test(s) skipped (expected)

✅ PASS (Windows mode - symlink skips allowed)
```

## Linux Verification Output (WSL)

**Command:** `wsl python3 scripts/verify_tool_invoke_coverage.py`

```
=== Tool Invoke Coverage Verifier ===
Platform: linux
Windows Mode: False

Running pytest...

=== Test Results ===
Passed:  57
Failed:  0
Skipped: 0

✅ PASS: All 57 tests passed
   Symlink tests executed successfully on non-Windows platform.
```

## GitHub Actions Linux Verification (Audit Status)

**Status:** INACCESSIBLE (Local-only)

> [!NOTE]
> The GitHub Actions workflow `.github/workflows/tool_invoke_hardening.yml` is currently unpushed (local-only state).
> Browser-based audit of [marcusglee11/LifeOS/actions](https://github.com/marcusglee11/LifeOS/actions) confirms no runs have executed.
>
> CI enforcement is **configured** but not yet **substantiated by remote logs**.
> Non-Windows execution proof is provided via **WSL** (see section above).

---

## Acceptance Criteria

| Criterion | Status |
|-----------|--------|
| Plan updated with P0 clarifications | ✅ PASS |
| CI includes Linux job for symlink enforcement | ✅ PASS |
| Linux job fails if symlink tests skip | ✅ PASS (configured) |
| Windows job permits symlink skips | ✅ PASS (verified) |
| error.type assertions locked | ✅ PASS |
| decision_reason = non-stable contract | ✅ PASS |
| Evidence report produced | ✅ PASS |

---

*Generated by Antigravity under LifeOS Build Artifact Protocol v1.0.*
