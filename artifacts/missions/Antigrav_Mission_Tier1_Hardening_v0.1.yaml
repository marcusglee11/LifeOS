Antigrav_Mission_Tier1_Hardening_v0.1.yaml
mission_id: Tier1_Hardening_v0.1
version: 0.1
authority: Architecture_Ideation_Project
execution_target: COO_Runtime
description: >
  Execute the full Stage 1 Tier-1 Hardening pipeline as approved by the Human CEO.
  This includes deterministic validation, AMU₀ discipline, DAP enforcement,
  anti-failure validation, and governance protection implementation.
  Perform Fix Packs FP-3.1, FP-3.2, FP-3.3, FP-3.7, FP-3.9 in strict order.
  Produce a deterministic Tier-1 Hardening Completion Report.

safety:
  autonomy_ceiling:
    max_files_modified: 40
    max_directories_modified: 6
    allow_new_modules: true
    allow_new_tests: true
    allow_doc_updates: true
    prohibit_protected_paths: true
  protected_paths:
    - docs/00_foundations
    - docs/01_governance
    - docs/02_alignment
    - docs/03_runtime/Runtime_Specification*
    - docs/INDEX*
    - config/protected/*
  prohibited_actions:
    - delete_protected_files
    - modify_governance_specs
    - modify_constitutional_files
    - apply_missions_not_in_this_packet

runtime_contracts:
  repo_root: .
  state_root: runtime_state/PRE_HARDENING_AMU0/
  tests_path: runtime/tests/
  recursive_kernel_path: recursive_kernel/
  dap_write_gateway: runtime/dap_gateway.py
  workflow_validator: runtime/workflows/validator.py
  governance_registry: config/governance/protected_artefacts.json

execution_flow:
  # Gate G1 — Initialise
  - step: G1_initialise_baseline
    actions:
      - ensure_clean_repo_state: true
      - create_amu0_baseline:
          output: runtime_state/PRE_HARDENING_AMU0/
      - record_repo_manifest: true
      - record_test_manifest: true
      - lock_protected_paths: true
    outputs:
      - PRE_HARDENING_AMU0
      - repo_manifest.json
      - test_manifest.json

  # Stage 1 — Fix Packs (mandatory)
  - step: FP_3_1_determinism_suite_and_fsm_validation
    description: Implement and validate determinism suite and FSM test coverage.
    modify:
      - path: runtime/tests/test_determinism.py
      - path: runtime/tests/test_fsm_transitions.py
      - path: runtime/fsm/*
    actions:
      - implement_determinism_test_suite: true
      - implement_fsm_legal_illegal_transition_tests: true
      - eliminate_nondeterministic_sources:
          remove_time_calls: true
          remove_random_calls: true
          remove_env_entropy: true
      - run_tests: true
      - run_determinism_suite:
          runs: 3
    must_pass: [tests, determinism_suite]

  - step: FP_3_2_amu0_discipline_and_state_lineage
    description: Implement AMU₀ lifecycle operations and tests.
    modify:
      - path: runtime/state/amu0.py
      - path: runtime/tests/test_amu0_lineage.py
    actions:
      - implement_amu0_operations:
          create_amu0: true
          restore_amu0: true
          promote_run_to_amu0: true
      - implement_state_lineage_tests: true
      - run_tests: true
      - run_determinism_suite:
          runs: 3
    must_pass: [tests, determinism_suite]

  - step: FP_3_3_dap_write_gateway_and_index_coherence
    description: Implement DAP write gateway and automatic index reconciliation.
    modify:
      - path: runtime/dap_gateway.py
      - path: runtime/index/indexer.py
      - path: runtime/tests/test_dap_gateway.py
    actions:
      - implement_dap_write_gateway: true
      - enforce_boundary_checks: true
      - enforce_deterministic_naming: true
      - implement_index_auto_update: true
      - run_tests: true
      - run_determinism_suite:
          runs: 3
    must_pass: [tests, determinism_suite]

  - step: FP_3_7_anti_failure_workflow_validator
    description: Implement Anti-Failure Validation (≤5 steps; ≤2 human steps).
    modify:
      - path: runtime/workflows/validator.py
      - path: runtime/tests/test_workflow_validator.py
    actions:
      - implement_workflow_validator:
          max_steps: 5
          max_human_steps: 2
          enforce_no_routine_human_ops: true
      - integrate_antigrav_mission_precheck: true
      - run_tests: true
      - run_determinism_suite:
          runs: 3
    must_pass: [tests, determinism_suite]

  - step: FP_3_9_governance_protections_and_autonomy_ceilings
    description: Implement governance boundaries and autonomy ceilings.
    modify:
      - path: config/governance/protected_artefacts.json
      - path: runtime/governance/protection.py
      - path: runtime/tests/test_governance_protection.py
    actions:
      - implement_protected_artefact_registry: true
      - enforce_read_only_protections: true
      - implement_autonomy_ceiling_validation:
          max_scope: safe
      - run_tests: true
      - run_determinism_suite:
          runs: 3
    must_pass: [tests, determinism_suite]

  # Completion Gate — G3
  - step: G3_generate_completion_report
    actions:
      - compile_fix_pack_summaries: true
      - compile_test_results: true
      - compile_determinism_results: true
      - compile_amu0_lineage_results: true
      - compile_governance_protection_results: true
      - write_markdown_report:
          path: docs/internal/Tier1_Hardening_Completion_Report_v0.1.md
    outputs:
      - docs/internal/Tier1_Hardening_Completion_Report_v0.1.md

outputs_expected:
  - fix_packs:
      - FP-3.1
      - FP-3.2
      - FP-3.3
      - FP-3.7
      - FP-3.9
  - completion_report: docs/internal/Tier1_Hardening_Completion_Report_v0.1.md

success_condition: >
  All tests and determinism checks pass for all Fix Packs;
  protected artefacts remain untouched; AMU₀ lineage validated;
  DAP boundaries enforced; workflow validator operational;
  governance protections functioning; completion report produced.

failure_policy:
  - if_tests_fail: abort_and_report
  - if_determinism_fails: abort_and_report
  - if_protected_write_attempted: abort_and_report
  - on_abort: produce_diagnostic_report
