{
    "task_id": "BUILD_PACKET_OPS_001",
    "task_type": "code_creation",
    "instruction": {
        "objective": "Implement packet_route and gate_check operations with transforms and schema validation to enable Phase 3 mission execution",
        "context_files": [
            "docs/03_runtime/LifeOS_Autonomous_Build_Loop_Architecture_v0.3.md",
            "runtime/orchestration/operations.py",
            "runtime/orchestration/engine.py",
            "runtime/packets/schemas.py"
        ],
        "deliverables": [
            {
                "file": "runtime/orchestration/transforms/__init__.py",
                "description": "Package exports"
            },
            {
                "file": "runtime/orchestration/transforms/base.py",
                "description": "Transform registry and base classes"
            },
            {
                "file": "runtime/orchestration/transforms/council.py",
                "description": "to_council_context_pack transform"
            },
            {
                "file": "runtime/orchestration/transforms/review.py",
                "description": "to_review_packet transform"
            },
            {
                "file": "runtime/orchestration/transforms/build.py",
                "description": "to_build_packet transform"
            },
            {
                "file": "runtime/orchestration/validation.py",
                "description": "Schema validation logic for gate_check"
            },
            {
                "file": "runtime/orchestration/operations.py",
                "description": "MODIFY: Replace packet_route and gate_check stubs with real implementations"
            },
            {
                "file": "config/schemas/build_packet.yaml",
                "description": "JSON Schema for BUILD_PACKET validation"
            },
            {
                "file": "config/schemas/review_packet.yaml",
                "description": "JSON Schema for REVIEW_PACKET validation"
            },
            {
                "file": "config/schemas/council_approval_packet.yaml",
                "description": "JSON Schema for COUNCIL_APPROVAL_PACKET validation"
            },
            {
                "file": "config/schemas/mission.yaml",
                "description": "JSON Schema for mission YAML validation per v0.3 ยง5.3.1"
            },
            {
                "file": "tests/test_transforms.py",
                "description": "Unit tests for all transforms"
            },
            {
                "file": "tests/test_validation.py",
                "description": "Unit tests for schema validation including negative cases"
            }
        ],
        "specifications": {
            "packet_route": {
                "purpose": "Transform packets between types using registered transforms",
                "signature": "_handle_packet_route(operation, ctx) -> (result, evidence)",
                "params": {
                    "transform": "Name of registered transform (e.g., 'to_council_context_pack')",
                    "input": "Source packet dict",
                    "additional_context": "Optional extra data for transform"
                },
                "behavior": [
                    "Look up transform by name in registry",
                    "Validate input packet has required fields for transform",
                    "Execute transform",
                    "Validate output packet matches expected schema",
                    "Return transformed packet with evidence"
                ],
                "errors": [
                    "TransformNotFound",
                    "TransformInputInvalid",
                    "TransformOutputInvalid"
                ]
            },
            "gate_check": {
                "purpose": "Validate packets against schemas and check preconditions",
                "signature": "_handle_gate_check(operation, ctx) -> (result, evidence)",
                "params": {
                    "schema": "Schema name (e.g., 'BUILD_PACKET') OR",
                    "check": "Named check (e.g., 'builder_envelope', 'steward_envelope') OR",
                    "condition": "Expression to evaluate (e.g., '{{verdict}} == approved')"
                },
                "behavior": [
                    "If schema: validate data against JSON schema from config/schemas/",
                    "If check: run named validation function",
                    "If condition: evaluate expression against context",
                    "Return pass/fail with detailed evidence"
                ],
                "errors": [
                    "SchemaNotFound",
                    "ValidationFailed",
                    "ConditionEvalError"
                ]
            },
            "transforms_required": {
                "to_council_context_pack": {
                    "input": "BUILD_PACKET or REVIEW_PACKET",
                    "output": "COUNCIL_CONTEXT_PACK with subject, context, review_type fields"
                },
                "to_review_packet": {
                    "input": "Build output + evidence from builder",
                    "output": "REVIEW_PACKET with artifacts_produced, test_results, summary"
                },
                "to_build_packet": {
                    "input": "Design output from designer",
                    "output": "BUILD_PACKET with scope, deliverables, constraints"
                }
            },
            "schema_validation": {
                "library": "jsonschema (already in project) or pydantic",
                "behavior": "Fail-closed: missing fields or wrong types reject the packet",
                "evidence": "Include which fields failed and why"
            }
        },
        "constraints": [
            "Transforms are governance-controlled per v0.3 ยง2.3: note this but implement anyway",
            "Use jsonschema library for validation (verify in requirements.txt, add if missing)",
            "All transforms must be stateless and deterministic",
            "Evidence must include input hash, output hash, transform version",
            "Negative tests required: invalid input, missing fields, schema mismatch",
            "Do not modify files in docs/00_foundations/ or docs/01_governance/",
            "Follow existing patterns in operations.py for handler signatures"
        ],
        "success_criteria": [
            "packet_route can invoke all three transforms",
            "gate_check validates packets against schemas",
            "gate_check evaluates condition expressions",
            "Invalid packets are rejected with clear error messages",
            "All unit tests pass including negative cases",
            "No modifications outside allowed paths"
        ]
    },
    "envelope": {
        "allowed_paths": [
            "runtime/orchestration/",
            "runtime/packets/",
            "config/schemas/",
            "tests/"
        ],
        "allowed_actions": [
            "read",
            "write",
            "create",
            "mkdir"
        ],
        "forbidden_paths": [
            "docs/00_foundations/",
            "docs/01_governance/",
            "scripts/opencode_gate_policy.py",
            "runtime/governance/",
            "config/agent_roles/",
            "config/governance_baseline.yaml"
        ]
    },
    "evidence_requirements": {
        "pre_state": "git status, git rev-parse HEAD",
        "post_state": "git diff --stat, full diff",
        "test_output": "pytest -v on all new test files",
        "file_manifest": "List of all created/modified files with SHA-256",
        "negative_test_proof": "Show at least 3 negative tests that correctly reject invalid input"
    }
}